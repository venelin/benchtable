<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A User Guide to the R-package ‘benchtable’ • benchtable</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A User Guide to the R-package ‘benchtable’">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129563006-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129563006-5');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">benchtable</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/benchtable.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/venelin/benchtable">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>A User Guide to the R-package ‘benchtable’</h1>
                        <h4 class="author">Venelin Mitov</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/venelin/benchtable/blob/master/vignettes/benchtable.Rmd"><code>vignettes/benchtable.Rmd</code></a></small>
      <div class="hidden name"><code>benchtable.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <strong>benchtable</strong> package provides an easy way to handle computational tasks on varying sets of parameters and input data. It’s goals are:</p>
<ul>
<li>to set a standard for storing input parameters and data together with results in one table:
<ul>
<li>every column of the table corresponds to an input parameter or an input object such as a phylogeny or an output object such as a an lm-fit.<br>
</li>
<li>every row corresponds to a different combination of input parameters, data and results.<br>
</li>
<li>this table is a <a href="https://cran.r-project.org/package=data.table">data.table</a> object. A <code>data.table</code> can be regarded as an improved <code>data.frame</code> providing suitable syntax for selecting specific rows, applying operations on columns as well as grouping and summarising rows by some of the columns.<br>
</li>
</ul>
</li>
<li>to help you with the execution of a given computational task on some (all) of the rows in the table.
<ul>
<li>all you will be doing is writing functions that do the computation on one row and call the <code><a href="../reference/benchmark.html">benchmark()</a></code> function from the interactive R-console or <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code> for running your tasks in parallel.<br>
</li>
<li>While this is very similar to calling the <code>apply()</code> function on rows, it also does handling of errors, measuring execution time and storing the results as a column in the table.<br>
</li>
</ul>
</li>
<li>to assist you in the process of running parallel computational tasks by generating shell scripts for job-submission:
<ul>
<li>all you will be doing is calling <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code> to generate a shell script, use rsync to transfer the script and the data to the cluster and call the script on the cluster.<br>
</li>
<li>you will indicate where to run the jobs (brutus cluster, new bsse-cluster or your local shell) simply by specifying the argument <code>type</code> in the call to <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code>. This means that you will no more need to remember the syntax of the bsub and qsub commands.<br>
</li>
</ul>
</li>
<li>to assist you in the process of collecting the results of your parallel jobs:
<ul>
<li>all you will be doing after completion of your parallel jobs is rsync-ing the resulting <code>.RData</code> files from your directory on the cluster into a local directory, than call the <code><a href="../reference/collectBenchRes.html">collectBenchRes()</a></code> function to store the results as new columns in the table.<br>
</li>
</ul>
</li>
<li>to provide some basic analysis functions for comparing the results obtained on different rows in the table.<br>
</li>
<li>to provide some syntactic shortcuts that shorten your code (this is yet experimental and I don’t know if this makes the code more readable…)</li>
</ul>
</div>
<div id="example-1--calling-the-benchmark-function" class="section level1">
<h1 class="hasAnchor">
<a href="#example-1--calling-the-benchmark-function" class="anchor"></a>Example 1. Calling the <code><a href="../reference/benchmark.html">benchmark()</a></code> function</h1>
<p>I wrote the function <code><a href="../reference/benchmark.html">benchmark()</a></code> benchmark before even thinking about wrapping everything in a package. Think of it as of calling <code>apply()</code> on the rows of a table with some error handling, i.e. wrapping your code in a call to <code>try()</code>. For more information type <code><a href="../reference/benchmark.html">?benchmark</a></code>.</p>
<div id="creating-some-input-parameters-and-data" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-some-input-parameters-and-data" class="anchor"></a>Creating some input parameters and data</h2>
<p>Let’s create a data.table with various parameters as columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(benchtable)</code></pre></div>
<pre><code>## Loading required package: data.table</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
<span class="co"># Only requirement for your data.table: have an integer column called id with unique numbers.</span>
dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">120</span>, <span class="dt">N=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">10</span>, <span class="dv">60</span>), <span class="kw">rep</span>(<span class="dv">100</span>, <span class="dv">60</span>)), <span class="dt">A=</span><span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="dv">120</span>), <span class="dt">B=</span><span class="kw">rep</span>(<span class="fl">0.8</span>, <span class="dv">120</span>), 
                 <span class="dt">Epsilon=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="fl">0.1</span>, <span class="dv">30</span>), <span class="kw">rep</span>(<span class="fl">0.2</span>, <span class="dv">30</span>), <span class="kw">rep</span>(<span class="fl">0.1</span>, <span class="dv">30</span>), <span class="kw">rep</span>(<span class="fl">0.2</span>, <span class="dv">30</span>)))
<span class="co"># Good practice: specify the column 'id' as a key-column in dt.</span>
<span class="kw">setkey</span>(dt, id)</code></pre></div>
<p>Generate some input data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen.x &lt;-<span class="st"> </span><span class="cf">function</span>(p) {
  <span class="kw">round</span>(<span class="kw">runif</span>(<span class="dt">n=</span>p[[<span class="st">'N'</span>]]), <span class="dt">digits=</span><span class="dv">1</span>)
}
<span class="co"># execute gen.x for every row p of dt and store the result in a column called 'x'</span>
dt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/benchmark.html">benchmark</a></span>(gen.x, dt, <span class="dt">fname=</span><span class="st">'x'</span>) </code></pre></div>
<pre><code>## Fitting time: 0.04 s</code></pre>
<p>Execute a function on each row of the data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gen.y &lt;-<span class="st"> </span><span class="cf">function</span>(p) {
  p[[<span class="st">'A'</span>]]<span class="op">+</span>p[[<span class="st">'x'</span>]]<span class="op">*</span>p[[<span class="st">'B'</span>]]<span class="op">+</span><span class="kw">rnorm</span>(p[[<span class="st">'N'</span>]], <span class="dt">sd=</span>p[[<span class="st">'Epsilon'</span>]])
}
<span class="co"># execute gen.y for every row p of dt and store the result in a column called 'y'</span>
dt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/benchmark.html">benchmark</a></span>(gen.y, dt, <span class="dt">fname=</span><span class="st">'y'</span>)</code></pre></div>
<pre><code>## Fitting time: 0.024 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(dt, <span class="dt">digits=</span><span class="dv">1</span>)</code></pre></div>
<pre><code>##       id   N   A   B Epsilon                           x
##   1:   1  10 0.5 0.8     0.1 0.3,0.4,0.6,0.9,0.2,0.9,...
##   2:   2  10 0.5 0.8     0.1 0.2,0.2,0.7,0.4,0.8,0.5,...
##   3:   3  10 0.5 0.8     0.1 0.9,0.2,0.7,0.1,0.3,0.4,...
##   4:   4  10 0.5 0.8     0.1 0.5,0.6,0.5,0.2,0.8,0.7,...
##   5:   5  10 0.5 0.8     0.1 0.8,0.6,0.8,0.6,0.5,0.8,...
##  ---                                                    
## 116: 116 100 0.5 0.8     0.2 0.2,0.6,1.0,0.1,0.7,0.1,...
## 117: 117 100 0.5 0.8     0.2 0.6,0.4,0.6,0.2,0.8,0.2,...
## 118: 118 100 0.5 0.8     0.2 0.1,0.9,0.6,0.8,0.3,0.9,...
## 119: 119 100 0.5 0.8     0.2 0.5,0.9,0.8,0.2,0.4,0.9,...
## 120: 120 100 0.5 0.8     0.2 0.7,0.3,1.0,0.4,0.2,0.8,...
##                                y
##   1: 0.7,0.8,1.0,1.2,0.5,1.1,...
##   2: 0.7,0.9,1.2,0.9,1.2,1.0,...
##   3: 1.1,0.7,1.0,0.3,0.6,0.9,...
##   4: 1.2,1.1,0.9,0.6,1.1,1.1,...
##   5: 1.2,0.8,1.3,1.0,0.9,1.2,...
##  ---                            
## 116: 0.9,1.0,1.1,0.6,0.8,0.6,...
## 117: 1.2,0.5,1.0,0.6,1.2,1.0,...
## 118: 0.8,1.0,0.8,1.3,0.5,1.1,...
## 119: 1.0,1.0,1.1,0.6,0.5,1.3,...
## 120: 0.9,0.5,1.1,1.0,0.5,1.3,...</code></pre>
<p>There’s only one requirement for your data.table, namely, to have an integer column called id. These id-numbers are unique for each line and are used when executing tasks and collecting results.</p>
<p>Now that we have our data, we can fit some model to it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># save this to a file lmFit.R </span>
lmFit &lt;-<span class="st"> </span><span class="cf">function</span>(p, ...) {
  <span class="kw">lm</span>(y<span class="op">~</span>x, p[<span class="kw">c</span>(<span class="st">'y'</span>, <span class="st">'x'</span>)], ...)
}</code></pre></div>
<p>We save the above function to a file ‘lmFit.R’ as, later on, we are going to run it in parallel on the cluster.</p>
<p>Now we call <code><a href="../reference/benchmark.html">benchmark()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/benchmark.html">benchmark</a></span>(lmFit, dt)</code></pre></div>
<pre><code>## Fitting time: 0.139 s</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(dt, <span class="dt">digits=</span><span class="dv">1</span>)</code></pre></div>
<pre><code>##       id   N   A   B Epsilon                           x
##   1:   1  10 0.5 0.8     0.1 0.3,0.4,0.6,0.9,0.2,0.9,...
##   2:   2  10 0.5 0.8     0.1 0.2,0.2,0.7,0.4,0.8,0.5,...
##   3:   3  10 0.5 0.8     0.1 0.9,0.2,0.7,0.1,0.3,0.4,...
##   4:   4  10 0.5 0.8     0.1 0.5,0.6,0.5,0.2,0.8,0.7,...
##   5:   5  10 0.5 0.8     0.1 0.8,0.6,0.8,0.6,0.5,0.8,...
##  ---                                                    
## 116: 116 100 0.5 0.8     0.2 0.2,0.6,1.0,0.1,0.7,0.1,...
## 117: 117 100 0.5 0.8     0.2 0.6,0.4,0.6,0.2,0.8,0.2,...
## 118: 118 100 0.5 0.8     0.2 0.1,0.9,0.6,0.8,0.3,0.9,...
## 119: 119 100 0.5 0.8     0.2 0.5,0.9,0.8,0.2,0.4,0.9,...
## 120: 120 100 0.5 0.8     0.2 0.7,0.3,1.0,0.4,0.2,0.8,...
##                                y lmFit
##   1: 0.7,0.8,1.0,1.2,0.5,1.1,...  &lt;lm&gt;
##   2: 0.7,0.9,1.2,0.9,1.2,1.0,...  &lt;lm&gt;
##   3: 1.1,0.7,1.0,0.3,0.6,0.9,...  &lt;lm&gt;
##   4: 1.2,1.1,0.9,0.6,1.1,1.1,...  &lt;lm&gt;
##   5: 1.2,0.8,1.3,1.0,0.9,1.2,...  &lt;lm&gt;
##  ---                                  
## 116: 0.9,1.0,1.1,0.6,0.8,0.6,...  &lt;lm&gt;
## 117: 1.2,0.5,1.0,0.6,1.2,1.0,...  &lt;lm&gt;
## 118: 0.8,1.0,0.8,1.3,0.5,1.1,...  &lt;lm&gt;
## 119: 1.0,1.0,1.1,0.6,0.5,1.3,...  &lt;lm&gt;
## 120: 0.9,0.5,1.1,1.0,0.5,1.3,...  &lt;lm&gt;</code></pre>
</div>
<div id="quick-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-analysis" class="anchor"></a>Quick analysis</h2>
<p>We can use the grouping functionality of the class <a href="https://cran.r-project.org/package=data.table">data.table</a> to do some quick analysis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, <span class="kw">list</span>(<span class="dt">meanBHat=</span>{BHat &lt;-<span class="st"> </span><span class="kw">sapply</span>(lmFit, 
                                   <span class="cf">function</span>(fit) {
                                     <span class="cf">if</span>(<span class="kw">is.list</span>(fit)) 
                                       <span class="kw">coef</span>(fit)[<span class="dv">2</span>] 
                                     <span class="cf">else</span> <span class="ot">NA</span>
                                   })
                    <span class="kw">mean</span>(BHat, <span class="dt">na.rm=</span>T)},
          <span class="dt">sdBHat=</span><span class="kw">sd</span>(BHat, <span class="dt">na.rm=</span>T)), 
   by=<span class="kw">list</span>(Epsilon, N)]</code></pre></div>
<pre><code>##    Epsilon   N  meanBHat     sdBHat
## 1:     0.1  10 0.7844115 0.12934493
## 2:     0.2  10 0.7835289 0.22366592
## 3:     0.1 100 0.8080394 0.03217597
## 4:     0.2 100 0.7883110 0.08100235</code></pre>
<p>At first glance, the above example might be looking a bit complicated, so let me explain: <code>dt[i, j, by=list(col1, col2)]</code> returns another data.table object that represents the evaluation of expression j on the rows indexed by i, after grouping them according to columns col1 and col2. In the example, we selected all rows by omitting i, grouped them by the columns N and Epsilon and for every group we found the mean and standard deviation of the estimated linear regression slope. If you are not familiar with the data.table class, keep in mind that every column name mentioned in the j expression refers to a list or a vector with the elements in the column. Therefore we call sapply to obtain a vector of all regression slopes in the group. For more help on this, I recommend reading the package vignettes accessible from the main help-page <code>?data.table</code>.</p>
<p>In the example above I’ve written <code>if(is.list(fit))...</code> because this is the easiest way to check whether the call to <code>lm</code> was successful and returned a fit object. In case of an error, the returned object would be of class <code>try-error</code>. If you are confident that there are no errors you can safely omit the <code>if-else</code> statement.</p>
</div>
</div>
<div id="example-2--executing-benchmarks-on-a-cluster" class="section level1">
<h1 class="hasAnchor">
<a href="#example-2--executing-benchmarks-on-a-cluster" class="anchor"></a>Example 2. Executing benchmarks on a cluster</h1>
<p>Now, let’s get to the point of the <strong>benchtable</strong> package. Typically we wish to run our computations in parallel on a cluster such as brutus. Ideally, this should be as simple as running everything on the local computer. In practice, often much more effort is needed because one has to install the same packages on the cluster, copy one’s code and data to and back from the cluster and learn the cluster-specific command-line tools for manipulating parallel jobs. The following example is based on the <strong>benchtable</strong> functions <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code> and <code><a href="../reference/collectBenchRes.html">collectBenchRes()</a></code> and the command line-tool <code>rsync</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># save the data in the current directory</span>
<span class="kw">save</span>(dt, <span class="dt">file=</span><span class="st">'dt.RData'</span>)

<span class="co"># generate an R-script for benchmark execution, j_lmFit.R, </span>
<span class="co"># and a shell script for job-submission, j_bsub_lmFit.sh:</span>
<span class="kw"><a href="../reference/genBenchJobs.html">genBenchJobs</a></span>(lmFit, <span class="dt">table.file=</span><span class="st">'dt.RData'</span>, <span class="dt">ids=</span>dt[, id], <span class="dt">perJob=</span><span class="dv">10</span>, 
             <span class="dt">type=</span><span class="st">'bsub'</span>, <span class="dt">sources=</span><span class="st">'lmFit.R'</span>)</code></pre></div>
<p>In the call to <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code> we specified that we want to execute the function <code>lmFit()</code> on all id’s in the data.table object found in the file ‘dt.RData’. We also specified that we would like to have each parallel job executed the function on 10 rows and run the jobs on the brutus server. We could as well have specified needed R-packages and R-source files in the call to <code><a href="../reference/genBenchJobs.html">genBenchJobs()</a></code>. Additional arguments are explained in the help <code><a href="../reference/genBenchJobs.html">?genBenchJobs</a></code>. You can verify that an R-script and a shell script have been generated in the local directory.</p>
<p>Now, time to copy everything needed to the cluster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># move the scripts and the data on the brutus cluster </span>
<span class="kw">system</span>(<span class="st">'rsync -vc lmFit.R vmitov@brutus:~'</span>)
<span class="kw">system</span>(<span class="st">'rsync -vc j_* vmitov@brutus:~'</span>)
<span class="kw">system</span>(<span class="st">'rsync -vc dt.RData vmitov@brutus:~'</span>)</code></pre></div>
<p>Now, go to the cluster and run the shell-script:</p>
<pre><code>[vmitov@brutus4 ~]$ sh j_bsub_lmFit.sh 
Generic job.
Job &lt;75543729&gt; is submitted to queue &lt;pub.8h&gt;.
Generic job.
...</code></pre>
<p>After completing the jobs, we copy the results from the cluster in the local directory. There is one resulting data-file for each job:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use the --remove-source-files to automatically clean-up the data from the cluster</span>
<span class="kw">system</span>(<span class="st">'rsync -vc --remove-source-files vmitov@brutus:~/job_*.RData .'</span>)</code></pre></div>
<p>Then it remains to collect the results into the data.table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/collectBenchRes.html">collectBenchRes</a></span>(<span class="st">'lmFit'</span>, dt, <span class="dt">dir.res=</span><span class="st">'.'</span>)</code></pre></div>
<pre><code>## Warning in collectBenchRes("lmFit", dt, dir.res = "."): Matching entries in
## column(s) lmFit will be overwritten.</code></pre>
<p>So that’s it. The warning was issued because we already had a column ‘lmFit’ in the dt table.</p>
<p><em>Note</em> that the current implementation of <code><a href="../reference/collectBenchRes.html">collectBenchRes()</a></code> relies on the <code>find</code> command which is not available on windows. That is why it only works on unix and mac-os based systems. A work-around in case you are using windows on your local machine would be to do the result-collection on the cluster and transfer the data.table file on your windows machine. In future versions I may implement an alternative approach for windows.</p>
<p>Skipping the output, here’s all the code for running the tasks in parallel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">save</span>(dt, <span class="dt">file=</span><span class="st">'dt.RData'</span>)

<span class="co"># generate an R-script for benchmark execution, j_lmFit.R, </span>
<span class="co"># and a shell script for job-submission, j_bsub_lmFit.sh:</span>
<span class="kw"><a href="../reference/genBenchJobs.html">genBenchJobs</a></span>(lmFit, <span class="dt">table.file=</span><span class="st">'dt.RData'</span>, <span class="dt">ids=</span>dt[, id], <span class="dt">perJob=</span><span class="dv">10</span>, 
             <span class="dt">type=</span><span class="st">'bsub'</span>, <span class="dt">sources=</span><span class="st">'lmFit.R'</span>)

<span class="co"># move the scripts and the data on the brutus cluster </span>
<span class="kw">system</span>(<span class="st">'rsync -vc lmFit.R vmitov@brutus:~'</span>)
<span class="kw">system</span>(<span class="st">'rsync -vc j_* vmitov@brutus:~'</span>)
<span class="kw">system</span>(<span class="st">'rsync -vc dt.RData vmitov@brutus:~'</span>)

<span class="co"># after executing on brutus</span>
<span class="kw">system</span>(<span class="st">'rsync -vc --remove-source-files vmitov@brutus:~/job_*.RData .'</span>)
dt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/collectBenchRes.html">collectBenchRes</a></span>(<span class="st">'lmFit'</span>, dt, <span class="dt">dir.res=</span><span class="st">'.'</span>)</code></pre></div>
</div>
<div id="some-syntactic-sugar" class="section level1">
<h1 class="hasAnchor">
<a href="#some-syntactic-sugar" class="anchor"></a>Some syntactic sugar</h1>
<p>Finally, I want to mention some handy tools that I’m currently wrapping in the package, though at a later stage I might decide to remove them or put them in another package. One thing that has always annoyed me about R is the syntax of the apply-functions. Everytime you call apply or sapply or lapply, you have to define a function for the sake of giving a name to the element of the array you will be operating on. In some cases, particularly, when the body of the function comprises just a short expression, it might be much prettier if you could directly type the expression. Therefore I defined a couple of shortcut-function to sapply, and lapply, assuming that the element name is ‘.’. Using this syntactic “sugar”, the above example can be written as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt[, <span class="kw">list</span>(<span class="dt">meanBHat=</span>{BHat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/s..html">s.</a></span>(lmFit, <span class="cf">if</span>(<span class="kw">is.list</span>(.)) <span class="kw">coef</span>(.)[<span class="dv">2</span>] <span class="cf">else</span> <span class="ot">NA</span>)
                    <span class="kw">mean</span>(BHat, <span class="dt">na.rm=</span>T)},
          <span class="dt">sdBHat=</span><span class="kw">sd</span>(BHat, <span class="dt">na.rm=</span>T)), 
   by=<span class="kw">list</span>(N, Epsilon)]</code></pre></div>
<pre><code>##      N Epsilon  meanBHat     sdBHat
## 1:  10     0.1 0.7834697 0.10715575
## 2:  10     0.2 0.8097814 0.20633241
## 3: 100     0.1 0.8018793 0.02799134
## 4: 100     0.2 0.8026159 0.07073690</code></pre>
<p>This was a way shorter but keep in mind that it is yet experimental, and I haven’t tested it on very long lists. You can call ‘?s.’ for more information on this.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#example-1--calling-the-benchmark-function">Example 1. Calling the <code><a href="--/reference/benchmark-html">benchmark()</a></code> function</a><ul class="nav nav-pills nav-stacked">
<li><a href="#creating-some-input-parameters-and-data">Creating some input parameters and data</a></li>
      <li><a href="#quick-analysis">Quick analysis</a></li>
      </ul>
</li>
      <li><a href="#example-2--executing-benchmarks-on-a-cluster">Example 2. Executing benchmarks on a cluster</a></li>
      <li><a href="#some-syntactic-sugar">Some syntactic sugar</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Venelin Mitov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
